# 红楼梦知识图谱数据预处理方案

## 1. 文本预处理

### 1.1 文本清洗

- **繁简转换**: 统一为简体中文
- **标点符号规范化**: 统一中英文标点符号
- **章节分割**: 按回目进行文本分段
- **噪音去除**: 删除版权信息、页码、注释等非正文内容
- **编码统一**: 确保UTF-8编码

### 1.2 文本结构化

- **段落分割**: 按照自然段进行切分
- **对话识别**: 标识人物对话部分
- **叙述文本分离**: 区分对话和叙述性文本
- **诗词单独处理**: 提取诗词部分进行特殊标记

## 2. 实体识别与标注

### 2.1 人物实体

- **主要人物**: 贾宝玉、林黛玉、薛宝钗等主角
- **次要人物**: 丫鬟、仆人、亲戚等
- **人物别名处理**: 宝玉/宝二爷、黛玉/林妹妹等
- **人物关系标注**: 父子、主仆、夫妻等关系

### 2.2 地点实体

- **府邸**: 荣国府、宁国府、潇湘馆、怡红院等
- **地理位置**: 京城、江南等
- **房间场所**: 大观园各处景点

### 2.3 物品实体

- **重要物品**: 通灵宝玉、金锁等
- **日常用品**: 服饰、饰品、书籍等
- **食物药品**: 茶点、药材等

### 2.4 事件实体

- **重大情节**: 黛玉葬花、宝玉出家等
- **日常事件**: 诗社活动、宴会等

## 3. 关系抽取

### 3.1 人物关系

- **血缘关系**: 父子、母女、兄弟姐妹等
- **社会关系**: 主仆、师生、朋友等
- **情感关系**: 恋人、仇敌、知己等

### 3.2 空间关系

- **居住关系**: 人物与地点的居住关系
- **活动场所**: 人物经常出现的地点
- **地理层级**: 房间-院落-府邸的层级关系

### 3.3 事件关系

- **参与关系**: 人物参与的事件
- **因果关系**: 事件之间的因果联系
- **时序关系**: 事件的先后顺序

## 4. LLM特化处理

### 4.1 上下文窗口优化

- **文本分块**: 按语义完整性进行分块（512-2048 tokens）
- **重叠处理**: 相邻块之间保持适当重叠
- **关键信息保留**: 确保重要实体和关系不被截断

### 4.2 提示工程准备

- **实体类型定义**: 为LLM提供明确的实体类型说明
- **关系类型枚举**: 预定义所有可能的关系类型
- **示例样本**: 准备少样本学习的示例

### 4.3 数据格式化

- **JSON结构**: 采用标准JSON格式存储三元组
- **批处理格式**: 按章节或场景组织数据批次
- **验证数据集**: 准备人工标注的验证集

## 5. 质量控制

### 5.1 数据一致性

- **实体统一**: 确保同一实体的不同表述被正确合并
- **关系验证**: 检查关系的逻辑一致性
- **时间线检查**: 验证事件的时序合理性

### 5.2 完整性检查

- **实体覆盖**: 确保重要实体都被识别
- **关系完整**: 检查关键关系是否遗漏
- **章节平衡**: 各章节的信息密度均衡

## 6. 输出格式

### 6.1 三元组格式

```json
{
  "subject": "贾宝玉",
  "predicate": "居住于",
  "object": "怡红院",
  "chapter": 3,
  "confidence": 0.95
}
```

### 6.2 实体信息

```json
{
  "entity": "林黛玉",
  "type": "人物",
  "aliases": ["黛玉", "林妹妹", "潇湘妃子"],
  "description": "贾母外孙女，多愁善感",
  "first_mention": "第2回"
}
```

## 7. 技术栈建议

- **文本处理**: jieba, spacy, LTP
- **实体识别**: BERT-NER, LLM API调用
- **关系抽取**: 规则+模型混合方法
- **数据存储**: Neo4j, JSON文件
- **质量评估**: 人工标注+自动化检查

## 8. 预期产出

1. 清洗后的结构化文本
2. 实体库（人物、地点、物品、事件）
3. 关系三元组集合
4. 知识图谱可视化数据
5. LLM训练/推理用的格式化数据集
