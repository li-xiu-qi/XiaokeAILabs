## 上下文实体召回率

`ContextEntityRecall`（上下文实体召回率）指标用于衡量检索到的上下文中实体的召回率，基于 `reference`（参考内容）和 `retrieved_contexts`（检索到的上下文）中共同存在的实体数量相对于 `reference` 中实体总数的比例。简单来说，它衡量的是从 `reference` 中召回的实体所占的比例。该指标在基于事实的用例中非常有用，例如旅游帮助台、历史问答等。通过与 `reference` 中的实体进行比较，该指标可以帮助评估实体的检索机制，因为在实体重要的情况下，我们需要能够覆盖这些实体的 `retrieved_contexts`。

计算该指标时，我们使用两个集合：

- **$RE$**：参考内容中的实体集合。
- **$RCE$**：检索到的上下文中的实体集合。

我们计算两个集合中共有的实体数量（$RCE \cap RE$），并将其除以参考内容中的实体总数（$RE$）。公式如下：

$$
\text{上下文实体召回率} = \frac{\text{$RCE$ 和 $RE$ 之间的共有实体数量}}{\text{$RE$ 中的实体总数}}
$$

### 示例

```python
from ragas import SingleTurnSample
from ragas.metrics import ContextEntityRecall

sample = SingleTurnSample(
  reference="埃菲尔铁塔位于巴黎。",
  retrieved_contexts=["埃菲尔铁塔位于巴黎。"],
)

scorer = ContextEntityRecall(llm=evaluator_llm)

await scorer.single_turn_ascore(sample)
```

输出

### 计算方法

示例

**参考内容**：泰姬陵是一座象牙白色的大理石陵墓，位于印度城市阿格拉的亚穆纳河右岸。它于 1631 年由莫卧儿皇帝沙贾汗委托建造，以安置他最爱的妻子穆塔兹·马哈尔的陵墓。

**高实体召回率上下文**：泰姬陵是爱与建筑奇迹的象征，位于印度阿格拉。它由莫卧儿皇帝沙贾汗为纪念他心爱的妻子穆塔兹·马哈尔而建。这座建筑以其精美的大理石工艺和周围美丽的花园而闻名。

**低实体召回率上下文**：泰姬陵是印度的标志性纪念碑。它是联合国教科文组织的世界遗产，每年吸引数百万游客。精美的雕刻和令人惊叹的建筑使其成为必游之地。

让我们考虑上述参考内容和检索到的上下文。

- **第一步**：找出参考内容中的实体。
  - 参考内容中的实体（RE） - \["泰姬陵", "亚穆纳河", "阿格拉", "1631", "沙贾汗", "穆塔兹·马哈尔"\]
- **第二步**：找出检索到的上下文中的实体。
  - 上下文 1 中的实体（RCE1） - \["泰姬陵", "阿格拉", "沙贾汗", "穆塔兹·马哈尔", "印度"\]
  - 上下文 2 中的实体（RCE2） - \["泰姬陵", "联合国教科文组织", "印度"\]
- **第三步**：使用上述公式计算实体召回率

  $$
  \text{上下文实体召回率 1} = \frac{| RCE1 \cap RE |}{| RE |}
   = 4/6
   = 0.666
  $$

  $$
  \text{上下文实体召回率 2} = \frac{| RCE2 \cap RE |}{| RE |}
   = 1/6
  $$

  可以看出，第一个上下文具有较高的实体召回率，因为它在给定参考内容的情况下具有更好的实体覆盖率。如果这两个检索到的上下文是由相同的文档集合上的两个检索机制获取的，我们可以说在实体重要的用例中，第一个机制优于另一个机制。