## 响应相关性

`ResponseRelevancy`指标用于衡量响应与用户输入的相关性。较高的分数表示与用户输入的对齐度更好，而较低的分数则表示响应不完整或包含冗余信息。

该指标通过以下步骤使用`user_input`（用户输入）和`response`（响应）进行计算：

1. 根据响应生成一组人工问题（默认为3个）。这些问题旨在反映响应的内容。
2. 计算用户输入的嵌入（\(E_o\)）与每个生成问题的嵌入（\(E_{g_i}\)）之间的余弦相似度。
3. 取这些余弦相似度分数的平均值以获得**答案相关性**：

\[
\text{答案相关性} = \frac{1}{N} \sum_{i=1}^{N} \text{余弦相似度}(E_{g_i}, E_o)
\]

\[
\text{答案相关性} = \frac{1}{N} \sum_{i=1}^{N} \frac{E_{g_i} \cdot E_o}{\|E_{g_i}\| \|E_o\|}
\]

其中：

- \(E_{g_i}\)：第\(i\)个生成问题的嵌入。
- \(E_o\)：用户输入的嵌入。
- \(N\)：生成问题的数量（默认为3）。

**注意**：尽管分数通常在0到1之间，但由于余弦相似度的数学范围为-1到1，因此不能保证。

如果一个答案直接且适当地解决了原始问题，则认为该答案是相关的。该指标专注于答案与问题意图的匹配程度，而不评估事实准确性。它会惩罚不完整或包含不必要的细节的答案。

### 示例

```python
from ragas import SingleTurnSample
from ragas.metrics import ResponseRelevancy

sample = SingleTurnSample(
        user_input="第一届超级碗是什么时候？",
        response="第一届超级碗于1967年1月15日举行",
        retrieved_contexts=[
            "第一届AFL-NFL世界冠军赛是1967年1月15日在洛杉矶洛杉矶纪念体育馆举行的一场美式足球比赛。"
        ]
    )

scorer = ResponseRelevancy(llm=evaluator_llm, embeddings=evaluator_embeddings)
await scorer.single_turn_ascore(sample)
```

### 计算方式

示例：

问题：法国在哪里，它的首都是什么？

低相关性答案：法国位于西欧。

高相关性答案：法国位于西欧，巴黎是其首都。

要计算答案与给定问题的相关性，我们遵循以下两个步骤：

- **第一步**：使用大型语言模型（LLM）从生成的答案中反向生成‘n’个问题变体。
   例如，对于第一个答案，LLM可能会生成以下可能的问题：
   - _问题1_：“法国位于欧洲的哪个部分？”
   - _问题2_：“法国在欧洲的地理位置是什么？”
   - _问题3_：“你能确定法国所在的欧洲区域吗？”
- **第二步**：计算生成的问题与实际问题之间的平均余弦相似度。

其基本概念是，如果答案正确地解决了问题，那么仅从答案中重构原始问题是高度可能的。