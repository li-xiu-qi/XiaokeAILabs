# 噪声敏感性（NoiseSensitivity）

`NoiseSensitivity`（噪声敏感性）衡量的是系统在利用相关或不相关的检索文档时，因提供不正确的响应而产生错误的频率。该分数范围为0到1，值越低表示性能越好。噪声敏感性是通过`user_input`（用户输入）、`reference`（参考）、`response`（响应）和`retrieved_contexts`（检索到的上下文）来计算的。

为了估计噪声敏感性，需要检查生成响应中的每个声明，以确定其是否基于事实依据正确，并且是否可以归因于相关（或不相关）的检索上下文。理想情况下，答案中的所有声明都应由相关的检索上下文支持。

\[
\text{噪声敏感性（相关）} = \frac{\|\text{响应中不正确声明的总数}\|}{\|\text{响应中声明的总数}\|}
\]

## 示例

```python
from ragas.dataset_schema import SingleTurnSample
from ragas.metrics import NoiseSensitivity

sample = SingleTurnSample(
    user_input="印度人寿保险公司（LIC）以什么闻名？",
    response="印度人寿保险公司（LIC）是印度最大的保险公司，以其庞大的投资组合而闻名。LIC为国家的金融稳定做出了贡献。",
    reference="印度人寿保险公司（LIC）是印度最大的保险公司，于1956年通过保险业国有化成立。它以管理大型投资组合而闻名。",
    retrieved_contexts=[
        "印度人寿保险公司（LIC）于1956年在印度保险业国有化后成立。",
        "LIC是印度最大的保险公司，拥有庞大的保单持有人网络和巨额投资。",
        "作为印度最大的机构投资者，LIC管理着大量资金，为国家的金融稳定做出了贡献。",
        "印度经济是世界上增长最快的主要经济体之一，这得益于金融、技术、制造业等多个行业。"
    ]
)

scorer = NoiseSensitivity(llm=evaluator_llm)
await scorer.single_turn_ascore(sample)

```

输出

要计算不相关上下文的噪声敏感性，可以将`focus`参数设置为`irrelevant`（不相关）。

```python
scorer = NoiseSensitivity(focus="irrelevant")
await scorer.single_turn_ascore(sample)
```

## 计算方法

示例

问题：印度人寿保险公司（LIC）以什么闻名？

事实依据：印度人寿保险公司（LIC）是印度最大的保险公司，于1956年通过保险业国有化成立。它以管理大型投资组合而闻名。

相关检索：

- 印度人寿保险公司（LIC）于1956年在印度保险业国有化后成立。
- LIC是印度最大的保险公司，拥有庞大的保单持有人网络，在金融领域扮演着重要角色。
- 作为印度最大的机构投资者，LIC管理着大量的寿险基金，为国家的金融稳定做出了贡献。

不相关检索：

- 印度经济是世界上增长最快的主要经济体之一，这得益于金融、技术、制造业等多个行业。

让我们看看相关上下文中的噪声敏感性是如何计算的：

- **第一步：** 确定可以推断出事实依据的相关上下文。
  - 事实依据：
    印度人寿保险公司（LIC）是印度最大的保险公司，于1956年通过保险业国有化成立。它以管理大型投资组合而闻名。

  - 上下文：
    - 上下文1：印度人寿保险公司（LIC）于1956年在印度保险业国有化后成立。
    - 上下文2：LIC是印度最大的保险公司，拥有庞大的保单持有人网络，在金融领域扮演着重要角色。
    - 上下文3：作为印度最大的机构投资者，LIC管理着大量资金，为国家的金融稳定做出了贡献。
- **第二步：** 验证生成答案中的声明是否可以从相关上下文中推断出来。
  - 答案：
    印度人寿保险公司（LIC）是印度最大的保险公司，以其庞大的投资组合而闻名。LIC为国家的金融稳定做出了贡献。

  - 上下文：
    - 上下文1：印度人寿保险公司（LIC）于1956年在印度保险业国有化后成立。
    - 上下文2：LIC是印度最大的保险公司，拥有庞大的保单持有人网络，在金融领域扮演着重要角色。
    - 上下文3：作为印度最大的机构投资者，LIC管理着大量资金，为国家的金融稳定做出了贡献。
- **第三步：** 确定答案中是否有不正确的声明（即答案中不受事实依据支持的陈述）。

  - 事实依据：
    印度人寿保险公司（LIC）是印度最大的保险公司，于1956年通过保险业国有化成立。它以管理大型投资组合而闻名。

  - 答案：
    印度人寿保险公司（LIC）是印度最大的保险公司，以其庞大的投资组合而闻名。LIC为国家的金融稳定做出了贡献。

  说明：事实依据中没有提到LIC为国家的金融稳定做出了贡献。因此，答案中的这一陈述是不正确的。

  不正确陈述：1
  总声明数：3

- **第四步：** 使用公式计算噪声敏感性：

  \[
  \text{噪声敏感性} = \frac{\text{1}}{\text{3}} = 0.333
  \]

这得出一个噪声敏感性分数为0.333，表明答案中有三个声明中的一个是不正确的。
